function:
  name: omni-location-updates-api-${self:provider.stage}
  handler: src/locationUpdatesApi/index.handler
  description: P44 location Updates API - ${self:provider.stage}
  runtime: nodejs14.x
  layers:
    - { Ref: CommonLibsLambdaLayer }
  package:
    include:
      - src/locationUpdatesApi/index.js
      - src/shared/helper.js
      - src/shared/joiSchema.js
      - src/shared/dynamoDb.js
      - src/shared/logger.js
    exclude:
      - "**/*"
  events:
    - http:
        path: /updates
        method: POST
        private: true
        integration: lambda
        response:
          headers: ${self:custom.standardResponseHeaders}
          statusCodes:
            200:
              pattern: ""
            400:
              pattern: '[\s\S]*\[400\][\s\S]*'
              headers:
                Content-Type: "'application/json'"
              template: ${file(responseTemplate.vtl)}
            500:
              pattern: '[\s\S]*\[500\][\s\S]*'
              headers:
                Content-Type: "'application/json'"
              template: ${file(responseTemplate.vtl)}
  environment:
    SHIPMENT_HEADER_TABLE: ${ssm:/omni-wt-rt-updates/${self:provider.stage}/shipment-header/ddb.tableName~true}
    CUSTOMER_MCKESSON: ${ssm:/omni-p44-rt-updates/${self:provider.stage}/mckesson-customer/numbers}
    FUNCTION_NAME: omni-location-updates-api-${self:provider.stage}
    SERVICE_NAME: ${self:service}
    APPLICATION: DataWarehouse
